{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/RaenonX-Finance/kl-site-back/main/config.schema.json",
  "title": "KL Site Back Config Schema",
  "type": "object",
  "description": "JSON Schema for the px quoting server config.",
  "required": [
    "system",
    "log",
    "data"
  ],
  "additionalProperties": false,
  "properties": {
    "system": {
      "type": "object",
      "description": "System settings.",
      "required": [
        "app-id",
        "port",
        "service-key"
      ],
      "additionalProperties": false,
      "properties": {
        "app-id": {
          "type": "string",
          "description": "Application ID of the Touchance API. In general, this shouldn't need to change."
        },
        "port": {
          "type": "object",
          "description": "TCP port numbers to get the market data.",
          "required": [
            "quote"
          ],
          "additionalProperties": false,
          "properties": {
            "quote": {
              "type": "integer",
              "description": "TCP port number to get the price quotes."
            }
          }
        },
        "service-key": {
          "type": "string",
          "description": "Service key of the Touchance API. In general, this shouldn't need to change."
        }
      }
    },
    "log": {
      "type": "object",
      "description": "Logging related settings.",
      "required": [
        "suppress-warnings"
      ],
      "additionalProperties": false,
      "properties": {
        "suppress-warnings": {
          "type": "boolean",
          "description": "Determines if non-force warnings should be suppressed."
        },
        "output-directory": {
          "type": "string",
          "description": "Target directory to output the logs. Note that setting this disables console output."
        }
      }
    },
    "data": {
      "type": "object",
      "description": "Data related settings.",
      "required": [
        "stream",
        "source",
        "sr-level"
      ],
      "additionalProperties": false,
      "properties": {
        "stream": {
          "type": "object",
          "description": "Data streaming related settings.",
          "required": [
            "timeout-sec",
            "px-update-sec",
            "px-update-offset-sec",
            "px-update-market-sec"
          ],
          "additionalProperties": false,
          "properties": {
            "timeout-sec": {
              "type": "number",
              "description": "Data stream timeout in seconds. An error will be raised if no new data received after the given seconds.",
              "exclusiveMinimum": 0
            },
            "px-update-sec": {
              "type": "number",
              "description": "Complete price data update frequency. This should be greater than market data update frequency since this sends more data and takes more time for calculation.",
              "exclusiveMinimum": 0
            },
            "px-update-offset-sec": {
              "type": "number",
              "description": "Time offset in seconds to apply on complete price data time-gating. This can be filled with the estimate calculating duration of a full complete px data, therefore offsetting the additional time-gate delay caused by the aforementioned calculation. Check https://github.com/RaenonX-Finance/kl-site-back/issues/42 for more details.",
              "exclusiveMinimum": 0
            },
            "px-update-market-sec": {
              "type": "number",
              "description": "Market price data update frequency. This should be less than complete price data update frequency since this sends less data and takes almost no calculation.",
              "exclusiveMinimum": 0
            }
          }
        },
        "source": {
          "type": "array",
          "description": "Product specs to report the price data.",
          "uniqueItems": true,
          "items": {
            "type": "object",
            "description": "An entity of product spec to report.",
            "required": [
              "type",
              "exchange",
              "symbol",
              "expiry"
            ],
            "additionalProperties": false,
            "properties": {
              "type": {
                "type": "string",
                "description": "Product type.",
                "enum": [
                  "Futures"
                ]
              },
              "expiry": {
                "type": "string",
                "description": "Product expiry.",
                "enum": [
                  "HOT",
                  "HOT2"
                ]
              },
              "exchange": {
                "type": "string",
                "description": "Product exchange."
              },
              "symbol": {
                "type": "string",
                "description": "Product symbol."
              }
            }
          }
        },
        "sr-level": {
          "type": "object",
          "description": "Support-resistance level determination settings.",
          "required": [
            "custom"
          ],
          "additionalProperties": false,
          "properties": {
            "custom": {
              "type": "object",
              "description": "Custom S/R levels of all products. Key must be the product symbol. Note that the key is symbol (NQ), not the complete symbol (TC.F.CME.NQ.HOT).",
              "patternProperties": {
                "\\w+": {
                  "type": "array",
                  "description": "Custom S/R levels of a single product.",
                  "uniqueItems": true,
                  "items": {
                    "type": "object",
                    "description": "Single custom S/R level.",
                    "required": [
                      "level"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "level": {
                        "type": "number",
                        "description": "S/R level in Px.",
                        "minimum": 1
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "indicator": {
      "type": "object",
      "description": "Indicator related settings.",
      "required": [
        "ema-strong-sr",
        "ema-net"
      ],
      "additionalProperties": false,
      "properties": {
        "ema-net": {
          "type": "object",
          "description": "EMA periods to use for EMA net.",
          "required": [
            "fast",
            "slow"
          ],
          "additionalProperties": false,
          "properties": {
            "fast": {
              "type": "integer",
              "description": "Faster EMA period to use.",
              "exclusiveMinimum": 0
            },
            "slow": {
              "type": "integer",
              "description": "Slower EMA period to use.",
              "exclusiveMinimum": 0
            }
          }
        },
        "ema-strong-sr": {
          "type": "array",
          "description": "EMA period pairs to use for EMA pairs that provide strong support/resistance.",
          "minItems": 1,
          "uniqueItems": true,
          "items": {
            "type": "object",
            "description": "Available pairs for strong S/R EMA period pairs.",
            "required": [
              "fast",
              "slow"
            ],
            "additionalProperties": false,
            "properties": {
              "fast": {
                "type": "integer",
                "description": "Faster EMA period to use.",
                "exclusiveMinimum": 0
              },
              "slow": {
                "type": "integer",
                "description": "Slower EMA period to use.",
                "exclusiveMinimum": 0
              }
            }
          }
        },
        "sr-level": {
          "type": "object",
          "description": "S/R level calculation settings.",
          "required": [
            "min-diff"
          ],
          "additionalProperties": false,
          "properties": {
            "min-diff": {
              "type": "number",
              "description": "Minimum difference between levels.",
              "exclusiveMinimum": 0
            },
          }
        }
      }
    }
  }
}
