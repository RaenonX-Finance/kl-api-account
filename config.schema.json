{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/RaenonX-Finance/kl-site-back/main/config.schema.json",
  "title": "KL Site Back Config Schema",
  "type": "object",
  "description": "JSON Schema for the px quoting server config.",
  "required": [
    "system",
    "log",
    "data"
  ],
  "additionalProperties": false,
  "properties": {
    "system": {
      "type": "object",
      "description": "System settings.",
      "required": [
        "app-id",
        "port",
        "service-key"
      ],
      "additionalProperties": false,
      "properties": {
        "app-id": {
          "type": "string",
          "description": "Application ID of the Touchance API. In general, this shouldn't need to change."
        },
        "port": {
          "type": "object",
          "description": "TCP port numbers to get the market data.",
          "required": [
            "quote"
          ],
          "additionalProperties": false,
          "properties": {
            "quote": {
              "type": "integer",
              "description": "TCP port number to get the price quotes."
            }
          }
        },
        "service-key": {
          "type": "string",
          "description": "Service key of the Touchance API. In general, this shouldn't need to change."
        }
      }
    },
    "log": {
      "type": "object",
      "description": "Logging related settings.",
      "required": [
        "suppress-warnings"
      ],
      "additionalProperties": false,
      "properties": {
        "suppress-warnings": {
          "type": "boolean",
          "description": "Determines if non-force warnings should be suppressed."
        }
      }
    },
    "data": {
      "type": "object",
      "description": "Data related settings.",
      "required": [
        "stream",
        "source",
        "sr-level",
        "sma"
      ],
      "additionalProperties": false,
      "properties": {
        "stream": {
          "type": "object",
          "description": "Data streaming related settings.",
          "required": [
            "timeout-sec",
            "px-update-sec",
            "px-update-market-sec"
          ],
          "additionalProperties": false,
          "properties": {
            "timeout-sec": {
              "type": "number",
              "description": "Data stream timeout in seconds. An error will be raised if no new data received after the given seconds.",
              "exclusiveMinimum": 0
            },
            "px-update-sec": {
              "type": "number",
              "description": "Complete price data update frequency. This should be greater than market data update frequency since this sends more data and takes more time for calculation.",
              "exclusiveMinimum": 0
            },
            "px-update-market-sec": {
              "type": "number",
              "description": "Market price data update frequency. This should be less than complete price data update frequency since this sends less data and takes almost no calculation.",
              "exclusiveMinimum": 0
            }
          }
        },
        "source": {
          "type": "array",
          "description": "Product specs to report the price data.",
          "uniqueItems": true,
          "items": {
            "type": "object",
            "description": "An entity of product spec to report.",
            "required": [
              "type",
              "exchange",
              "symbol",
              "expiry"
            ],
            "additionalProperties": false,
            "properties": {
              "type": {
                "type": "string",
                "description": "Product type.",
                "enum": [
                  "Futures"
                ]
              },
              "expiry": {
                "type": "string",
                "description": "Product expiry.",
                "enum": [
                  "HOT",
                  "HOT2"
                ]
              },
              "exchange": {
                "type": "string",
                "description": "Product exchange."
              },
              "symbol": {
                "type": "string",
                "description": "Product symbol."
              }
            }
          }
        },
        "sr-level": {
          "type": "object",
          "description": "Support-resistance level determination settings.",
          "required": [
            "strong-threshold",
            "custom"
          ],
          "additionalProperties": false,
          "properties": {
            "strong-threshold": {
              "type": "number",
              "description": "Threshold to determine that if an S/R level is strong in terms of its relative strength.",
              "exclusiveMinimum": 0,
              "exclusiveMaximum": 1
            },
            "custom": {
              "type": "object",
              "description": "Custom S/R levels of all products. Key must be the product symbol. Note that the key is symbol (NQ), not the complete symbol (TC.F.CME.NQ.HOT).",
              "patternProperties": {
                "\\w+": {
                  "type": "array",
                  "description": "Custom S/R levels of a single product.",
                  "uniqueItems": true,
                  "items": {
                    "type": "object",
                    "description": "Single custom S/R level.",
                    "required": [
                      "level"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "level": {
                        "type": "number",
                        "description": "S/R level in Px.",
                        "minimum": 1
                      },
                      "strong": {
                        "type": "boolean",
                        "description": "Determines if the S/R level is strong.",
                        "default": false
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "sma": {
          "type": "array",
          "description": "SMA periods to calculate.",
          "minItems": 1,
          "uniqueItems": true,
          "items": {
            "type": "integer",
            "description": "SMA period.",
            "minimum": 1
          }
        }
      }
    }
  }
}
